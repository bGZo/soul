alias:: Inter Process Communication, 进程间通信
  - 通信类
    collapsed:: true
    - 在进程之间传递消息，交换数据
    - 分成两种
      - 传递消息的（如消息队列）
      - 通过共享一片内存区域来完成信息的交换的（比如共享内存）
  - 同步类
    collapsed:: true
    - 协调进程间的操作
      - 某些操作，多个进程不能同时执行，否则可能会产生错误的结果
- ## [[Linux]] #linux/kernel
  collapsed:: true
  - ## PIPE
    collapsed:: true
    - 管道中的内容是阅后即焚的
      - 读取管道内容是消耗型的行为，即一个进程读取了管道内的一些内容之后，这些内容就不会继续在管道之中了。
    - 是一种文件
      - 可以调用read、write和close等操作文件的接口来操作管道。
    - 又不是一种普通的文件
      - 它属于一种独特的文件系统：pipefs
      - 管道的本质是内核维护了一块缓冲区与管道文件相关联，对管道文件的操作，被内核转换成对这块缓冲区内存的操作
    - ### Anonymous PIPE
      id:: 630374b6-6f4c-4536-af7f-23530c6f3b75
      - 哪两个有亲缘关系的进程使用该管道来通信应是事先约定好的
      - 成功调用pipe函数之后，会返回两个打开的文件描述符
        - 管道的读取端描述符pipefd[0]
        - 管道的写入端描述符pipefd[1]
      - 管道没有文件名与之关联，因此程序只能通过文件描述符来访问管道
        - 只有那些能看到这两个文件描述符的进程才能够使用管道
        - 只有该进程及该进程的子孙进程才能看到。这就限制了管道的使用范围。
      - 如果当前管道为空，那么read调用会阻塞（如果没有设置 O_NONBLOCK 标志位的话）
      - read_pipefifo_fops
      - write_pipefifo_fops
      - 一个进程管道起不到任何通信的作用。这不是通信，而是自言自语
        - fork后，子进程复制了父进程打开的文件描述符, 两条通信的通道就建立了
        - 父子进程一方只能写入，另一方只能读出，管道变成一个单向的通道，以方便使用
      - 这两个文件描述符对应的是一块内存缓冲区域
      - #### 关闭未使用的管道文件描述符
        - 只有当所有的写入端描述符都已关闭，且管道中的数据都被读出，对读取端描述符调用read函数才会返回0（即读到EOF标志）。
        - 如果所有读取端描述符都已关闭，此时进程再次往管道里面写入数据，写操作会失败，errno被设置为EPIPE，同时内核会向写入进程发送一个SIGPIPE的信号。
        - 当所有的读取端和写入端都关闭后，管道才能被销毁
        - 因为内核维护的引用计数发现还有进程可以写入管道，因此read函数依旧会阻塞
        - 如果子进程忘记关闭管道的写入端，（删除上面示例代码中加粗的一行）结局就大相径庭了。
          - 纵然父进程关闭了管道的写入端，但是因为管道仍然存在一个写入端，所以子进程的read函数依旧会阻塞，无法返回
        - 当最后一个读取端关闭时，向管道写入会触发SIGPIPE信号，同时write会返回失败，errno为EPIPE
        - 管道是文件的一种，在/proc/PID/fd/下可以看到打开的管道文件
      - #### shell管道的实现
        - 复制文件描述符
          ```c
          dup2(pipefd[1],STDOUT_FILENO);
          dup2(pipefd[0],STDIN_FILENO);
          ```
        - 第一个子进程的标准输出被绑定到了管道的写入端，于是第一个命令的输出，写入了管道
        - 第二个子进程管道将其标准输入绑定到管道的读取端，只要管道里面有了内容，这些内容就成了标准输入
      -
    - ### FIFO 命名管道
      id:: 6254fb38-d9ef-4afc-ab4c-f75d8f857b1f
      - TODO 缓冲区可以用 `String` 吗? 使用的时候总是报 "段错误, 核心转储". 不知道为什么
  - ## System V IPC
    collapsed:: true
    - ### 消息队列
    -
    - ### 信号量
    -
    - ### 共享内存
  - ## Refs
    collapsed:: true
    - [[Linux环境编程]]